/* ===========================
   Base + variables de thème
=========================== */
:host, .cryptizen-root { all: initial; }
.cryptizen-root {
  /* Police système propre */
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  position: fixed; right: 16px; bottom: 16px; z-index: 2147483647;

  /* Variables par défaut (sombre) */
  --bg: #0b1220;
  --fg: #e6edf3;
  --muted: #9aa4b2;
  --panel: #0f172a;
  --border: rgba(255,255,255,.08);
  --shadow: 0 10px 30px rgba(0,0,0,.28), 0 4px 12px rgba(0,0,0,.18);
  --primary: #4f46e5;
  --primary-600: #4338ca;
  --accent: #7c3aed;
  --success-bg: #052e1b;
  --success: #22c55e;
  --surface: color-mix(in srgb, var(--fg) 5%, var(--bg));
  --surface-2: color-mix(in srgb, var(--fg) 8%, var(--bg));
  --radius: 16px;
  --radius-sm: 12px;
  --gap: 12px;
  --transition: 160ms cubic-bezier(.2,.8,.2,1);
}

@media (prefers-color-scheme: light) {
  .cryptizen-root {
    --bg: #f7f8fb;
    --fg: #0b1220;
    --muted: #475569;
    --panel: #ffffff;
    --border: rgba(15,23,42,.08);
    --shadow: 0 12px 28px rgba(15,23,42,.08), 0 6px 14px rgba(15,23,42,.06);
    --surface: color-mix(in srgb, var(--fg) 3%, var(--panel));
    --surface-2: color-mix(in srgb, var(--fg) 6%, var(--panel));
  }
}

@media (prefers-reduced-motion: reduce) {
  .cryptizen-root { --transition: 0ms linear; }
}

/* ===========================
   Toast / Panel flottant
=========================== */
.cryptizen-card {
  background: linear-gradient(180deg, var(--surface), var(--panel));
  color: var(--fg);
  border-radius: var(--radius);
  padding: 16px;
  box-shadow: var(--shadow);
  width: 320px; max-width: min(94vw, 360px);
  border: 1px solid var(--border);
  backdrop-filter: blur(6px);
}
.cryptizen-card h3 {
  margin: 0 0 6px 0;
  font-size: 16px; font-weight: 700; letter-spacing: .2px;
}
.cryptizen-card p {
  margin: 0 0 10px 0;
  font-size: 13px; line-height: 1.45; color: var(--muted);
}
.cryptizen-row { display: flex; gap: 8px; margin-top: 10px; }

.cryptizen-btn {
  flex: 1; cursor: pointer; text-align: center; border: none;
  border-radius: var(--radius-sm); padding: 10px 12px; font-weight: 700; font-size: 13px;
  transition: transform var(--transition), box-shadow var(--transition), background var(--transition), color var(--transition);
  box-shadow: 0 2px 8px rgba(0,0,0,.12);
}
.cryptizen-btn:active { transform: translateY(1px); }
.cryptizen-btn:focus-visible {
  outline: 3px solid color-mix(in srgb, var(--primary) 55%, transparent);
  outline-offset: 2px;
}

.cryptizen-primary {
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: #fff;
}
.cryptizen-primary:hover { box-shadow: 0 6px 16px color-mix(in srgb, var(--primary) 35%, transparent); }

.cryptizen-secondary {
  background: var(--surface-2); color: var(--fg);
  border: 1px solid var(--border);
}
.cryptizen-secondary:hover { background: var(--surface); }

/* =========================== 
   FAB (Floating Action Button)
=========================== */

.cryptizen-floating {
  position: fixed;
  z-index: 9999; /* Assurez-vous que le bouton est au-dessus des autres éléments */
}

.cryptizen-floating.bottom-left {
  bottom: 10px;
  left: 10px;
}

.cryptizen-floating.bottom-right {
  bottom: 10px;
  right: 10px;
}

.cryptizen-floating.top-left {
  top: 10px;
  left: 10px;
}

.cryptizen-floating.top-right {
  top: 10px;
  right: 10px;
}

/* =========================== 
   Panel contextuel (menu)
=========================== */

.cryptizen-panel {
  position: fixed;
  width: 320px;
  max-width: min(94vw, 360px);
  background: linear-gradient(180deg, var(--surface), var(--panel));
  color: var(--fg);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(6px);
}

/* Spécifie la position du panneau contextuel par rapport à la position du FAB */
.cryptizen-panel.bottom-left {
  bottom: 80px;
  left: 10px;
}

.cryptizen-panel.bottom-right {
  bottom: 80px;
  right: 10px;
}

.cryptizen-panel.top-left {
  top: 80px;
  left: 10px;
}

.cryptizen-panel.top-right {
  top: 80px;
  right: 10px;
}

.cryptizen-fab {
  background-color: #2c3e50;
  color: white;
  font-size: 16px;
  border: none;
  border-radius: 50%;
  padding: 10px;
  cursor: pointer;
}

.cryptizen-fab:hover { transform: translateY(-2px); box-shadow: 0 14px 26px rgba(0,0,0,.24); filter: saturate(1.05); }
.cryptizen-fab:active { transform: translateY(0); }
.cryptizen-toggle { display:flex; align-items:center; gap:10px; margin:8px 0; }
.cryptizen-toggle input { width: 16px; height: 16px; accent-color: var(--primary); }
.cryptizen-small { font-size: 12px; color: var(--muted); }
.cryptizen-link { color: color-mix(in srgb, var(--primary) 85%, var(--fg)); text-decoration: underline; cursor:pointer; }

/* ===========================
   INLINE dans les bulles
   (style natif conservé)
=========================== */
.cm-inline, .cm-pill { font: inherit; color: inherit; }

/* ---- Card d'invitation / actions dans bulle ---- */
.cm-card {
  display: grid;
  grid-template-columns: 40px 1fr;
  grid-template-rows: auto auto auto;
  column-gap: 12px; row-gap: 10px; align-items: start;

  padding: 12px 14px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: linear-gradient(180deg, color-mix(in srgb, var(--fg) 6%, transparent), color-mix(in srgb, var(--fg) 9%, transparent));
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
}

.cm-card .cm-ico {
  width: 40px; height: 40px; border-radius: 10px;
  display: grid; place-items: center;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: white; font-weight: 800; font-size: 18px;
  grid-row: 1 / span 2;
  box-shadow: 0 4px 10px color-mix(in srgb, var(--primary) 24%, transparent);
}

.cm-card .cm-title { margin: 0; font-weight: 800; line-height: 1.2; }
.cm-card .cm-desc  { margin: 0; opacity: .92; }

.cm-card .cm-actions {
  grid-column: 2 / 3;
  display: flex; gap: 8px; margin-top: 6px;
}

.cm-btn {
  appearance: none; border: 0; border-radius: 10px; padding: 8px 12px;
  font-weight: 800; cursor: pointer; font-size: .95em;
  transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
}
.cm-btn:active { transform: translateY(1px); }
.cm-btn-primary { background: var(--primary); color: #fff; box-shadow: 0 4px 12px color-mix(in srgb, var(--primary) 28%, transparent); }
.cm-btn-primary:hover { background: var(--primary-600); }
.cm-btn-secondary { background: var(--surface-2); color: inherit; border: 1px solid var(--border); }
.cm-btn-secondary:hover { background: var(--surface); }

.cm-card .cm-meta {
  grid-column: 2 / 3;
  font-size: .9em; opacity: .75; letter-spacing: .2px;
}

/* ---- Badge compact (succès/info) ---- */
.cm-pill {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border);
  background: color-mix(in srgb, var(--success) 15%, transparent);
  color: inherit; box-shadow: 0 2px 8px rgba(0,0,0,.12);
}
.cm-pill .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--success); }

/* ---- Masquage sûr du texte original (on conserve la bulle native) ---- */
.cm-mask {
  color: transparent !important; user-select: none !important; caret-color: transparent !important;
}

/* ===========================
   Accessibilité / Responsif
=========================== */
.cm-btn:focus-visible,
.cryptizen-btn:focus-visible {
  outline: 3px solid color-mix(in srgb, var(--primary) 55%, transparent);
  outline-offset: 2px;
}

@media (max-width: 520px) {
  .cryptizen-panel, .cryptizen-card { border-radius: 14px; }
  .cm-card { grid-template-columns: 32px 1fr; border-radius: 12px; }
  .cm-card .cm-ico { width: 32px; height: 32px; border-radius: 8px; font-size: 16px; }
}

/* High-contrast/forced-colors friendly */
@media (forced-colors: active) {
  .cryptizen-card, .cryptizen-panel, .cm-card, .cm-pill {
    border: 1px solid CanvasText;
    background: Canvas;
    color: CanvasText;
    box-shadow: none;
  }
  .cryptizen-btn, .cm-btn { forced-color-adjust: none; }
  .cryptizen-primary, .cm-btn-primary { background: Highlight; color: HighlightText; }
  .cryptizen-secondary, .cm-btn-secondary { background: ButtonFace; color: ButtonText; }
}
